"use strict";var validation=0,applicationServerPublicKey="BGa5M248kds3Uw6AkR6igb3aq4OQw1zFmSBNuFj10kwdsqZ8DXoYtvLUPCMsUIpMKQiPzdOY-s-3mkVnPhRUiQg",isSubscribed=!1,swRegistration=null,pageWidth=$(document).width(),pageHeight=$(document).height(),colors=["#00FF00","#6699ff","#ff6600","#FF25FF","#FF6C6A","#53ff1a","#00C8FF","#ff66ff","#ff9900"];function clearData(){$("#newDialog").val(""),$("#imeDialog").val("").parent().removeClass("is-dirty"),$("#opisDialog").val("").parent().removeClass("is-dirty"),$("#targetZacetek").val("").parent().removeClass("is-dirty"),$("#targetKonec").val("").parent().removeClass("is-dirty"),$("#oldStatus").val(""),$("#newStatus").val("")}function fillNaloge(){$("#iDialog").html("Ime naloge"),$("#oDialog").html("Opis naloge"),$("#tZacetek").html("Začetek naloge"),$("#tKonec").html("Konec naloge"),$("#ciljiVsi").attr("style","display: none!important"),$("#dialogKategorija").attr("style","display: block!important"),$("#dialogZacetek").attr("style","display: block!important"),$("#dialogKonec").attr("style","display: block!important"),$("#claniNaloge").attr("style","display: block!important"),$("#dialogCilj").attr("style","display: block!important"),$("#dialogStatus").attr("style","display: block!important"),$("#update_dialog").attr("action","/ustvari_nalogo").attr("onsubmit","return validateNaloga()")}function fillCilji(){$("#iDialog").html("Ime cilja"),$("#oDialog").html("Opis cilja"),$("#tZacetek").html("Zacetek cilja"),$("#tKonec").html("Konec cilja"),$("#ciljiVsi").attr("style","display: block!important"),$("#dialogKategorija").attr("style","display: none!important"),$("#dialogZacetek").attr("style","display: none!important"),$("#dialogKonec").attr("style","display: none!important"),$("#claniNaloge").attr("style","display: none!important"),$("#dialogCilj").attr("style","display: none!important"),$("#dialogStatus").attr("style","display: none!important"),$("#update_dialog").attr("action","/ustvari_cilj").attr("onsubmit"," return validateCilj()")}function posodobiCilj(e){clearData(),fillCilji(),document.getElementById("dialog-title").innerHTML="Uredi cilj",document.getElementById("ustvari").innerHTML="Posodobi",$("#imeDialog").val(e.getElementsByTagName("td")[0].lastElementChild.lastElementChild.children[0].innerHTML).parent().addClass("is-dirty"),$("#opisDialog").val(e.getElementsByTagName("td")[0].lastElementChild.lastElementChild.children[1].innerHTML).parent().addClass("is-dirty"),$("#xpNaloge").val(e.getElementsByTagName("td")[0].lastElementChild.lastElementChild.children[2].value).parent().addClass("is-dirty"),"true"===e.getElementsByTagName("td")[0].lastElementChild.lastElementChild.children[3].value&&$("#skupnaNaloga").parent().get(0).MaterialCheckbox.check(),$("#newDialog").val(e.getElementsByTagName("td")[0].lastElementChild.lastElementChild.children[4].value),dialog.showModal(),$("#dialog-div").attr("style","height: auto")}function posodobiNalogo(){clearData(),fillNaloge(),document.getElementById("dialog-title").innerHTML="Uredi nalogo",document.getElementById("ustvari").innerHTML="Posodobi",dialog.showModal(),$("#dialog-div").attr("style","height: "+$("#dialog").height()+"px;")}function dodajNovCilj(){clearData(),fillCilji(),document.getElementById("dialog-title").innerHTML="Dodaj nov cilj",document.getElementById("ustvari").innerHTML="Ustvari",$("#newDialog").val(""),dialog.showModal(),$("#dialog-div").attr("style","height: auto")}function dodajNovoNalogo(){clearData(),fillNaloge(),document.getElementById("dialog-title").innerHTML="Dodaj novo nalogo",document.getElementById("ustvari").innerHTML="Ustvari",$("#newDialog").val(""),dialog.showModal(),$("#dialog-div").attr("style","height: "+$("#dialog").height()+"px;")}function validateCilj(){validation=1,validateNaloga()}function validateNaloga(){if(""==document.forms.update_dialog.imeDialog.value)return $("#imeDialogErr").text("Polje je obvezno!").parent().addClass("is-invalid"),!1;if(""==document.forms.update_dialog.opisDialog.value)return $("#opisDialogErr").text("Polje je obvezno!").parent().addClass("is-invalid"),!1;if(""==document.forms.update_dialog.xpNaloge.value)return!1;if($("#newDialog").val()?$("#sporocilo").innerText="Cilj je bil uspešno ustvarjen.":$("#sporocilo").innerText="Cilj je bil uspešno posodobljen.",0==validation){var e=document.forms.update_dialog.dateZacetek.value,t=document.forms.update_dialog.dateKonec.value;if(""!=e&&""!=t&&t<e)return $("#dateKonecErr").text("Datum konca mora biti po datumu začetka!").parent().addClass("is-invalid"),!1;if(""==document.forms.update_dialog.vezanCilj.value)return alert("Vezan cilj mora biti izbran."),!1;if(""==document.forms.update_dialog.sampleKategorija.value)return alert("Kategorija mora biti izbrana."),!1;if(""==document.forms.update_dialog.statusNaloge.value)return alert("Status naloge mora biti izbran."),!1;$("#newDialog").val()?$("#sporocilo").innerText="Naloga je bila uspešno ustvarjena.":$("#sporocilo").innerText="Naloga je bila uspešno posodobljena.",console.log("cilj")}validation=0}function registerDateTimePicker(t,i,a,n,o){var l=document.getElementById(t);l.addEventListener("click",function(e){i.trigger=l,i.toggle()}),l.addEventListener("onOk",function(e){openTimePicker(t,i,a,n,o)})}function openTimePicker(e,t,i,a,n){var o=document.getElementById(e),l=document.getElementById(i),r=document.getElementById(a);n.trigger=o,n.toggle(),o.addEventListener("onOk",function(e){r.value=t.time.format("Y-MM-DD")+" "+n.time.format("HH:mm Z"),l.value=t.time.format("DD-MM-Y")+" ob "+n.time.format("HH:mm"),l.parentNode.MaterialTextfield.checkDirty()}),o.addEventListener("onCancel",function(e){r.value=t.time.format("Y-MM-DD")+" "+(new Date).toLocaleTimeString("sl-SI",{hour:"numeric",minute:"numeric",timeZoneName:"short"}),l.value=t.time.format("DD-MM-Y"),l.parentNode.MaterialTextfield.checkDirty()})}function zapriVse(e){$(".hideOnClick").attr("style","display: none!important"),console.log("close all")}function onUserClick(e,t){var i=document.getElementsByClassName(e)[0].getElementsByClassName("user"),a=void 0;for(a=0;a<i.length;a++)i[a].onclick=function(e){return function(){t(e)}}(i[a])}function cleanNav(){$("#dashboard").removeClass("is-active"),$("#cilj").removeClass("is-active"),$("#naloge").removeClass("is-active"),$("#koledar").removeClass("is-active"),$("#menuDashboard").removeClass("is-active"),$("#menuCilj").removeClass("is-active"),$("#menuNaloge").removeClass("is-active"),$("#menuKoledar").removeClass("is-active")}function openSettings(){cleanNav(),$("#notifications").removeClass("is-active"),$("#druzina").removeClass("is-active"),$("#settings").addClass("is-active")}function openNotifications(){cleanNav(),$("#druzina").removeClass("is-active"),$("#settings").removeClass("is-active"),$("#notifications").addClass("is-active")}function openDruzina(){cleanNav(),$("#settings").removeClass("is-active"),$("#notifications").removeClass("is-active"),$("#druzina").addClass("is-active")}function initializeUI(){pushButton.addEventListener("click",function(){pushButton.disabled=!0,isSubscribed?unsubscribeUser():subscribeUser()}),swRegistration.pushManager.getSubscription().then(function(e){(isSubscribed=!(null===e))?console.log("User IS subscribed."):console.log("User is NOT subscribed."),updateBtn()})}function subscribeUser(){var e=urlB64ToUint8Array(applicationServerPublicKey);swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e}).then(function(e){updateSubscriptionOnServer(e),console.log("User is subscribed."),isSubscribed=!0,updateBtn()}).catch(function(e){console.log("Failed to subscribe the user: ",e),updateBtn()})}function updateSubscriptionOnServer(e){return fetch("/api/save-subscription",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)}).then(function(e){if(!e.ok)throw new Error("Bad status code from server.");return e.json()}).then(function(e){if(!e.data||!e.data.success)throw new Error("Bad response from server.")})}function unsubscribeUser(){swRegistration.pushManager.getSubscription().then(function(e){if(e)return e.unsubscribe()}).catch(function(e){console.log("Error unsubscribing",e)}).then(function(){updateSubscriptionOnServer(null),console.log("User is unsubscribed."),isSubscribed=!1,updateBtn()})}function urlB64ToUint8Array(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(t),a=new Uint8Array(i.length),n=0;n<i.length;++n)a[n]=i.charCodeAt(n);return a}function updateBtn(){if("denied"===Notification.permission)return pushButton.textContent="Obvestila so blokirana",pushButton.disabled=!0,void updateSubscriptionOnServer(null);isSubscribed?$("#pushButton").text("Izklopi obvestila v brskalniku"):$("#pushButton").text("Vklopi obvestila v brskalniku"),$("#pushButton").removeAttr("disabled")}function tockeUdelezencev(e,t,i){for(var a=0;a<e;a++){var n=$("."+t+a).children(),o=n.length,l=0;if(n.each(function(){l+=parseInt($(this)[0].innerHTML)}),$("#"+i+a).text(l+"/"+$("."+t+a).parent().prev().prev().find("input[name=maxXp]").val()),console.log($("."+t+a).parent().prev().prev().find("input[name=maxXp]")),0==o)$("."+t+a).attr("style","display: none!important");else if(1==o)$("."+t+a+" :nth-child(1)").addClass("spanOnly");else{$("."+t+a+" :nth-child(1)").attr("style","width: "+n[0].innerHTML/l*100+"%; background-color: #FF8C1A").addClass("spanFirst");for(var r=2;r<o;r++)$("."+t+a+" :nth-child("+r+")").attr("style","width: "+n[r-1].innerHTML/l*100+"%; background-color: "+colors[r-2]+";");$("."+t+a+" :nth-child("+o+")").attr("style","width: "+n[o-1].innerHTML/l*100+"%; background-color: yellow;").addClass("spanLast")}}}function zapriNalogo(){$("#NalogaPopUp").css("display","none")}function distanceX(e){return function(e){var t=0;if(e.offsetParent)for(;t+=e.offsetTop,e=e.offsetParent;);return 0<=t?t:0}(e)}jQuery(function(a){switch("serviceWorker"in navigator&&"PushManager"in window?(console.log("Service Worker and Push is supported"),navigator.serviceWorker.register("sw.js").then(function(e){console.log("Service Worker is registered",e),swRegistration=e,initializeUI()}).catch(function(e){console.error("Service Worker Error",e)})):(console.warn("Push messaging is not supported"),pushButton.textContent="Push Not Supported"),document.onclick=zapriVse(),document.onmouseup=function(e){var t=a(".card-info");a(t).is(":visible")&&(t.is(e.target)||0!==t.has(e.target).length||t.hide())},tockeUdelezencev(a("#table-cilji").find("tr").length-1,"progress","razmerje"),tockeUdelezencev(a("#table-cilji-end").find("tr").length-1,"progressE","razmerjeE"),onUserClick("container",function(e){var t=e.getBoundingClientRect(),i=a(".card-info");a("#userCard").text(e.nextElementSibling.value),a("#phoneCall").attr("href","tel:"+e.nextElementSibling.nextElementSibling.value),a("#smsSend").attr("href","sms:"+e.nextElementSibling.nextElementSibling.value),a("#mailSend").attr("href","mailto:"+e.nextElementSibling.nextElementSibling.nextElementSibling.value),a("#viberOpen").attr("href","viber://chats?number="+e.nextElementSibling.nextElementSibling.value),e.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling?(a("#status").html(e.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.children[0].innerHTML),a(".tri-card-no-status").removeClass("tri-card-no-status").addClass("tri-card-status")):(a("#status").html(""),a(".tri-card-status").addClass("tri-card-no-status").removeClass("tri-card-status")),600<pageWidth?a(".card-info").css({top:distanceX(e)-parseFloat(i.css("height")),left:t.left-93,display:"block"}):a(".card-info").css({top:distanceX(e)-parseFloat(i.css("height")),left:t.left-50,display:"block"})}),a("#mycalendar").monthly({mode:"event",dataType:"json",jsonUrl:id+"/data/events.json"}),window.location.protocol){case"http:":case"https:":break;case"file:":alert("Just a heads-up, events will not work when run locally.")}var e=document.querySelector("dialog");function t(e,t){var i=document.getElementById(e),a=i.getElementsByTagName("TR"),n=void 0;for(n=1;n<a.length;n++)i.rows[n].onclick=function(e){return function(){t(e)}}(i.rows[n])}e.showModal||dialogPolyfill.registerDialog(e),e.querySelector(".close").onclick=function(){e.close()},t("table-cilji",function(e){posodobiCilj(e)}),t("table-cilji-end",function(e){posodobiCilj(e)});var i=a("input[name=person]");a("#checkboxVsi").on("click",function(){a(this).is(":checked")?i.parent().each(function(e,t){t.MaterialCheckbox.check()}):i.parent().each(function(e,t){t.MaterialCheckbox.uncheck()})}),a(document).on("change","input[name=person]",function(e){a("#checkboxVsi").is(":checked")&&a("input[name=person]:checked").length<i.length?a("#checkboxVsi").parent()[0].MaterialCheckbox.uncheck():a("#checkboxVsi").is(":checked")||a("input[name=person]:checked").length!==i.length-1||a("#checkboxVsi").parent()[0].MaterialCheckbox.check()}),registerDateTimePicker("dialogZacetek",new mdDateTimePicker.default({type:"date",past:moment().subtract(1,"years"),future:moment().add(1,"years")}),"targetZacetek","dateZacetek",new mdDateTimePicker.default({type:"time"})),registerDateTimePicker("dialogKonec",new mdDateTimePicker.default({type:"date",past:moment().subtract(1,"years"),future:moment().add(1,"years")}),"targetKonec","dateKonec",new mdDateTimePicker.default({type:"time"})),e.appendChild(document.getElementById("mddtp-picker__time")),e.appendChild(document.getElementById("mddtp-picker__date"))});